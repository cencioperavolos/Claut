<%- include("../partials/header") %>

<div class="container">


    <div class="card my-3 bg-primary text-light-shade">
        <div class="card-body">
            <h4 class="card-title">Modifica parola:<span class="h1 font-weight-light twxt-white">
                    <%= word.clautano %></span></h4>
        </div>
    </div>

    <form id="updateForm" action="/words/<%= word._id %>?_method=PUT" method="POST">
        <div class="form-group">
            <label for="clautanoInput">Parola "clautana"</label>
            <input name="word[clautano]" type="text" class="form-control" value="<%= word.clautano %>"
                id="clautanoInput" aria-describedby="clautanolHelp" autofocus>
            <small id="wordlHelp" class="form-text text-muted">Inserire qui la parola in clautano da tradurre</small>
        </div>
        <div class="form-group">
            <label for="alternativoInput">Oppure</label>
            <input name="word[alternativo]" type="text" class="form-control" value="<%= word.alternativo %>"
                id="alternativoInput" aria-describedby="alternativolHelp">
            <small id="alternativolHelp" class="form-text text-muted">Inserire qui un'eventuale termine
                alternativo</small>
        </div>
        <div class="form-group">
            <label for="categoriaInput">Categoria</label>
            <input name="word[categoria]" type="text" class="form-control" value="<%= word.categoria %>"
                id="categoriaInput" aria-describedby="categorialHelp">
            <small id="categorialHelp" class="form-text text-muted">Inserire qui l'abbreivazione per la categoria
                di parola, per es. prep. = preposizione</small>
        </div>
        <div class="form-group">
            <label for="traduzioneTextarea">Traduzione italiana</label>
            <textarea name="word[traduzione]" class="form-control" id="traduzioneTextarea" rows="4"
                aria-describedby="traduzionelHelp"><%= word.traduzione %></textarea>
            <small id="traduzionelHelp" class="form-text text-muted">Inserire qui la traduzione in italiano della parola
                clautana</small>
        </div>
        <%= word.voc_claut_1996 %>
        <div class="form-check">
            <input name="word[voc_claut_1996]" class="form-check-input" type="checkbox" value="true"
                <%= word.voc_claut_1996 ? 'checked' : '' %> id="voc_claut_Check">
            <label class="form-check-label" for="voc_claut_Check"'>' VOCABOLARIO CLAUTANO - Borsatti, Giordani,
                Peressini - 1996'</label>
                <small id="voc_claut_Help" class="form-text text-muted">Spuntare se presente nel vocabolario
                    indicato</small>
        </div>

        <%- include("./expressionsTable") %>

        <button type="submit" class="btn btn-primary text-white mt-3">Salva</button>
        <a id="go-back" class="btn btn-primary text-light-shade mt-3">Annulla</a>
        <script>
            document.getElementById('go-back').addEventListener('click', () => {
                history.back();
            });
        </script>
    </form>

</div>

<%- include("../partials/jsLibs") %>

<script>
    // remove expressions row
    $('.table-remove').click(function () {
        $(this).parents('tr').detach();
    });

    // add expression row
    var $TABLE = $('#tableContainer');
    $('.table-add').click(function () {
        var $clone = $TABLE.find('tr.d-none').clone(true).removeClass('d-none').addClass('expression');
        $TABLE.find('table').append($clone);
    });

    $("#updateForm").submit(function (eventObj) {
        // $(this).find("input[name="+"something"+"]").remove()
        $("<input />").attr("type", "hidden")
            .attr("name", "expressions")
            .attr("value", getTableExpressions())
            .appendTo("#updateForm");
        return true;
    });

    function getTableExpressions() {
        const expressions = []
        const tData = [...expressionsTable.rows].map(t => [...t.children].map(u => u.innerText))
        for (let index = 2; index < tData.length; index++) {
            const exp = {
                "id": tData[index][0],
                "clautano": tData[index][1],
                "italiano": tData[index][2]
            }
            expressions.push(exp)
        }
        console.log(expressions)
        return JSON.stringify(expressions)
    }
</script>

</body>

</html>